# ATTEC Backend API

FastAPI backend for ATTEC website handling contact forms, authentication, and analytics.

## Features

- ğŸš€ Contact form API with email notifications
- ğŸ” JWT-based authentication
- ğŸ“Š Basic analytics tracking
- ğŸ“§ Email service integration (SendGrid)
- ğŸ—„ï¸ PostgreSQL database with SQLAlchemy
- âœ… Input validation with Pydantic
- ğŸ›¡ï¸ Security (CORS, rate limiting, input sanitization)
- ğŸ“ API documentation (auto-generated by FastAPI)

## Tech Stack

- **FastAPI** - Modern, fast web framework
- **SQLAlchemy** - ORM for database
- **PostgreSQL** - Database
- **Pydantic** - Data validation
- **SendGrid** - Email service
- **JWT** - Authentication
- **Alembic** - Database migrations

## Setup

### Prerequisites

- Python 3.11+
- PostgreSQL
- SendGrid account (free tier)

### Installation

```bash
# Create virtual environment
python -m venv venv

# Activate virtual environment
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Create .env file
cp .env.example .env
# Edit .env with your configuration

# Run database migrations
alembic upgrade head

# Create admin user
python scripts/create_admin.py

# Start development server
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

## Project Structure

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ endpoints/
â”‚   â”‚   â”‚   â”œâ”€â”€ contact.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚   â”‚   â””â”€â”€ analytics.py
â”‚   â”‚   â””â”€â”€ deps.py
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â””â”€â”€ email.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ contact.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â””â”€â”€ analytics.py
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ contact.py
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â””â”€â”€ analytics.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ email_service.py
â”‚   â”‚   â””â”€â”€ analytics_service.py
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ lead_notification.html
â”‚   â”‚   â””â”€â”€ auto_reply.html
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â””â”€â”€ session.py
â”‚   â””â”€â”€ main.py
â”œâ”€â”€ alembic/
â”‚   â””â”€â”€ versions/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ create_admin.py
â”œâ”€â”€ tests/
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ alembic.ini
â””â”€â”€ README.md
```

## API Endpoints

### Public Endpoints

#### Contact Form
```
POST /api/v1/contact
Body: {
  "name": "John Doe",
  "email": "john@example.com",
  "company": "Tech Corp",
  "message": "Interested in AI Integration service"
}
```

#### Analytics Event
```
POST /api/v1/analytics/event
Body: {
  "eventType": "page_view",
  "eventData": { "page": "services" }
}
```

### Protected Endpoints (Require Authentication)

#### Login
```
POST /api/v1/auth/login
Body: {
  "email": "admin@attec.co.ke",
  "password": "your-password"
}
```

#### Get Contact Submissions
```
GET /api/v1/contact/submissions
Headers: Authorization: Bearer <token>
Query: ?skip=0&limit=50&status=new
```

#### Update Contact Status
```
PATCH /api/v1/contact/submissions/{id}
Headers: Authorization: Bearer <token>
Body: {
  "status": "contacted",
  "notes": "Called and discussed requirements"
}
```

#### Analytics Summary
```
GET /api/v1/analytics/summary
Headers: Authorization: Bearer <token>
Query: ?start_date=2025-01-01&end_date=2025-12-31
```

## Environment Variables

See `.env.example` for all required variables:

- **DATABASE_URL**: PostgreSQL connection string
- **SECRET_KEY**: JWT secret key
- **SENDGRID_API_KEY**: SendGrid API key
- **FROM_EMAIL**: Sender email address
- **NOTIFICATION_EMAIL**: Team notification email
- **FRONTEND_URL**: Frontend URL for CORS

## Development

```bash
# Run with auto-reload
uvicorn app.main:app --reload

# Run tests
pytest

# Create new migration
alembic revision --autogenerate -m "description"

# Apply migrations
alembic upgrade head

# Rollback migration
alembic downgrade -1
```

## API Documentation

Once running, visit:
- Swagger UI: http://localhost:8000/docs
- ReDoc: http://localhost:8000/redoc

## Deployment

### Railway
1. Create new project
2. Add PostgreSQL database
3. Set environment variables
4. Deploy from GitHub

### Render
1. Create new Web Service
2. Add PostgreSQL database
3. Set environment variables
4. Deploy

## Security Features

- âœ… CORS configuration
- âœ… Rate limiting (100 req/15min)
- âœ… JWT authentication
- âœ… Password hashing (bcrypt)
- âœ… Input validation
- âœ… SQL injection protection
- âœ… XSS protection
- âœ… Request size limits

## License

Copyright Â© 2025 ATTEC. All rights reserved.
